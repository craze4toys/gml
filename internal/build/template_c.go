/*
 *  GML - Go QML
 *  Copyright (c) 2019 Roland Singer [roland.singer@deserbit.com]
 *  Copyright (c) 2019 Sebastian Borchers [sebastian@deserbit.com]
 */

package build

import "text/template"

var cMainHeaderTmpl = template.Must(template.New("t").Funcs(tmplFuncMap).Parse(cMainHeaderTmplText))

const cMainHeaderTmplText = `// This file is auto-generated by gml.
#ifndef GML_GEN_C_INCLUDE_H
#define GML_GEN_C_INCLUDE_H

{{ range .Packages -}}
#include "../{{.PackageName}}.h"
{{- end}}

#endif
`

var cHeaderTmpl = template.Must(template.New("t").Funcs(tmplFuncMap).Parse(cHeaderTmplText))

const cHeaderTmplText = `// This file is auto-generated by gml.
#ifndef GML_GEN_C_{{.PackageName}}_H
#define GML_GEN_C_{{.PackageName}}_H

#include <stdlib.h>
#include <stdint.h>

#ifdef __cplusplus
extern "C" {
#endif

{{/* Struct loop */ -}}
{{range $struct := .Structs -}}
//###
//### {{$struct.Name}}
//###

typedef void* {{$struct.CBaseName}};

{{$struct.CBaseName}} {{$struct.CBaseName}}_new(void* go_ptr);
void {{$struct.CBaseName}}_free({{$struct.CBaseName}});

{{- /* Signals */ -}}
{{- range $signal := $struct.Signals }}
void {{$struct.CBaseName}}_{{$signal.Name}}({{$struct.CBaseName}} _v{{cParams $signal.Params true false}});
{{end}}

{{- /* Slots */ -}}
{{- range $slot := $struct.Slots }}
typedef void (*{{$struct.CBaseName}}_{{$slot.Name}}_cb_t)(void* _go_ptr);
void {{$struct.CBaseName}}_{{$slot.Name}}_cb_register({{$struct.CBaseName}}_{{$slot.Name}}_cb_t cb);
{{end}}

{{- /* End of struct loop */ -}}
{{- end}}

#ifdef __cplusplus
}
#endif

#endif
`
